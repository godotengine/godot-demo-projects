[gd_scene format=3 uid="uid://cikrx8e0qde6d"]

[ext_resource type="Script" uid="uid://c74bp7pq3jbkx" path="res://main/developer_settings.gd" id="2_7mycd"]
[ext_resource type="PackedScene" uid="uid://jnc4cr2mhg00" path="res://in_game_hdr_settings/in_game_hdr_settings.tscn" id="3_h2yge"]
[ext_resource type="Script" uid="uid://bclxdn8806hud" path="res://main/max_val_label.gd" id="5_dg77c"]
[ext_resource type="PackedScene" uid="uid://drlb4o61s5wsk" path="res://color_sweep/color_sweep.tscn" id="6_7mycd"]
[ext_resource type="Script" uid="uid://fhoiawdcyegx" path="res://main/demo_scenes.gd" id="6_272bh"]
[ext_resource type="Texture2D" uid="uid://b335ssbw6ynt6" path="res://output_max_linear_value/Super Mountain Dusk/mountain.png" id="7_5vw27"]
[ext_resource type="Script" uid="uid://cpqmte6usoyyg" path="res://main/debug_info.gd" id="8_5vw27"]
[ext_resource type="Texture2D" uid="uid://cvecqn4m52x7x" path="res://output_max_linear_value/spark_particle2.png" id="8_kek77"]
[ext_resource type="Script" uid="uid://ow74i072fx6r" path="res://max_self_modulate.gd" id="9_4c57u"]
[ext_resource type="Script" path="res://environment/subviewport_scale.gd" id="10_dg77c"]
[ext_resource type="PackedScene" uid="uid://c0wukesav63su" path="res://environment/3d_environment.tscn" id="11_dg77c"]
[ext_resource type="Script" uid="uid://b6cwewu4wkvv5" path="res://setup_instructions/setup_instructions.gd" id="13_w48qg"]
[ext_resource type="Script" uid="uid://dxtpfowo3fjm4" path="res://max_colour.gd" id="13_ycdy4"]

[sub_resource type="Gradient" id="Gradient_4c57u"]
offsets = PackedFloat32Array(0, 0.0769231, 0.16568, 0.266272, 0.378698, 0.491124, 0.609467, 0.704142, 0.804734, 0.911243, 1)
colors = PackedColorArray(1, 1, 1, 1, 1, 0.152961, 0, 1, 1, 0.726562, 0, 1, 0.78125, 1, 0, 1, 0.289062, 1, 0, 1, 0, 1, 0.472656, 1, 0, 1, 0.835938, 1, 0, 0.71875, 1, 1, 0.21875, 0, 1, 1, 1, 0, 0.773438, 1, 1, 1, 1, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_efxa6"]
gradient = SubResource("Gradient_4c57u")

[sub_resource type="Curve" id="Curve_4c57u"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.24940729, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_efxa6"]
curve = SubResource("Curve_4c57u")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_dg77c"]
particle_flag_disable_z = true
radial_velocity_min = -2.2351742e-05
radial_velocity_max = 166.64998
gravity = Vector3(0, 0, 0)
linear_accel_min = 23.879997
linear_accel_max = 83.59
scale_curve = SubResource("CurveTexture_efxa6")
color_ramp = SubResource("GradientTexture1D_efxa6")

[sub_resource type="ViewportTexture" id="ViewportTexture_efxa6"]
viewport_path = NodePath("DemoScenes/EnvironmentScene/SubViewport")

[sub_resource type="SystemFont" id="SystemFont_7mycd"]
font_names = PackedStringArray("Monospace")
subpixel_positioning = 0

[node name="Control" type="Control" unique_id=1546781181]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="VBoxContainer" type="VBoxContainer" parent="." unique_id=2107551733]
layout_mode = 0
offset_right = 320.0
offset_bottom = 648.0

[node name="ColorRect" type="ColorRect" parent="VBoxContainer" unique_id=467859451]
layout_mode = 2
size_flags_vertical = 3
color = Color(0.21710123, 0.21710123, 0.21710123, 1)

[node name="InGameHDRSettings" parent="VBoxContainer/ColorRect" unique_id=1002679391 instance=ExtResource("3_h2yge")]
layout_mode = 0
offset_left = 5.0
offset_top = 7.0
offset_right = 315.0
offset_bottom = 233.0

[node name="ColorRect2" type="ColorRect" parent="VBoxContainer" unique_id=1685998796]
custom_minimum_size = Vector2(0, 398)
layout_mode = 2
color = Color(0.21568628, 0.21568628, 0.21568628, 1)

[node name="DeveloperSettings" type="VBoxContainer" parent="VBoxContainer/ColorRect2" unique_id=763217887]
layout_mode = 0
offset_left = 5.0
offset_top = 8.0
offset_right = 315.0
offset_bottom = 374.0
script = ExtResource("2_7mycd")

[node name="Label" type="Label" parent="VBoxContainer/ColorRect2/DeveloperSettings" unique_id=2123018716]
layout_mode = 2
text = "Developer settings:"

[node name="Button" type="Button" parent="VBoxContainer/ColorRect2/DeveloperSettings" unique_id=1727096126]
layout_mode = 2
text = "Erase player settings"

[node name="Label3" type="Label" parent="VBoxContainer/ColorRect2/DeveloperSettings" unique_id=182639080]
layout_mode = 2
text = "Reference monitor calibration:"

[node name="Control" type="Control" parent="VBoxContainer/ColorRect2/DeveloperSettings" unique_id=1779327274]
custom_minimum_size = Vector2(0, 78)
layout_mode = 2

[node name="MaxLumAdjustBacking" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=1341568457]
unique_name_in_owner = true
layout_mode = 0
offset_left = 9.0
offset_top = 4.0
offset_right = 129.0
offset_bottom = 74.0

[node name="MaxLumAdjustBelow2" type="Polygon2D" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=144371379]
unique_name_in_owner = true
self_modulate = Color(0.8848981, 0.8848981, 0.8848981, 1)
position = Vector2(40, 39)
scale = Vector2(50, 50)
polygon = PackedVector2Array(0, -0.5, 0.5, 0.5, -0.5, 0.5)

[node name="MaxLumAdjustBelow3" type="Polygon2D" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=106732800]
unique_name_in_owner = true
self_modulate = Color(0.9407874, 0.9407874, 0.9407874, 1)
position = Vector2(98, 39)
scale = Vector2(50, 50)
polygon = PackedVector2Array(0, -0.5, 0.5, 0.5, -0.5, 0.5)

[node name="ColorRect" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=443567928]
layout_mode = 0
offset_left = 136.0
offset_top = 4.0
offset_right = 186.0
offset_bottom = 39.0
color = Color(1, 0, 0, 1)

[node name="ColorRect2" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=1765336189]
layout_mode = 0
offset_left = 193.0
offset_top = 4.0
offset_right = 243.0
offset_bottom = 39.0
pivot_offset = Vector2(44, 29)
color = Color(0, 1, 0, 1)

[node name="ColorRect3" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=1445682559]
layout_mode = 0
offset_left = 250.0
offset_top = 4.0
offset_right = 300.0
offset_bottom = 39.0
pivot_offset = Vector2(44, -4)
color = Color(0, 0, 1, 1)

[node name="ColorRect4" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=1104706596]
layout_mode = 0
offset_left = 136.0
offset_top = 39.0
offset_right = 186.0
offset_bottom = 74.0
color = Color(1, 0, 0, 1)
script = ExtResource("13_ycdy4")
sdr_colour = Color(1, 0, 0, 1)

[node name="ColorRect5" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=2138302032]
layout_mode = 0
offset_left = 193.0
offset_top = 39.0
offset_right = 243.0
offset_bottom = 74.0
pivot_offset = Vector2(0, 29)
color = Color(0, 1, 0, 1)
script = ExtResource("13_ycdy4")
sdr_colour = Color(0, 1, 0, 1)

[node name="ColorRect6" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control" unique_id=1549780699]
layout_mode = 0
offset_left = 250.0
offset_top = 39.0
offset_right = 300.0
offset_bottom = 74.0
pivot_offset = Vector2(0, -4)
color = Color(0, 0, 1, 1)
script = ExtResource("13_ycdy4")
sdr_colour = Color(0, 0, 1, 1)

[node name="Label2" type="Label" parent="VBoxContainer/ColorRect2/DeveloperSettings" unique_id=332601797]
custom_minimum_size = Vector2(200, 0)
layout_mode = 2
size_flags_vertical = 6
text = "Set max luminance as high as possible while maintaining the visibility of both triangles and the hue and saturation of the three colors. Tap Reset to use the value reported by the display. Example:"
autowrap_mode = 3

[node name="Control2" type="Control" parent="VBoxContainer/ColorRect2/DeveloperSettings" unique_id=1021742490]
custom_minimum_size = Vector2(0, 78)
layout_mode = 2

[node name="MaxLumAdjustBacking" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=1125706939]
layout_mode = 0
offset_left = 9.0
offset_top = 4.0
offset_right = 129.0
offset_bottom = 74.0

[node name="ExampleMaxLumAdjustBelow" type="Polygon2D" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=1291892689]
unique_name_in_owner = true
self_modulate = Color(0.8848981, 0.8848981, 0.8848981, 1)
position = Vector2(40, 39)
scale = Vector2(50, 50)
polygon = PackedVector2Array(0, -0.5, 0.5, 0.5, -0.5, 0.5)

[node name="ExampleMaxLumAdjustBelow2" type="Polygon2D" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=1861809390]
unique_name_in_owner = true
self_modulate = Color(0.9407874, 0.9407874, 0.9407874, 1)
position = Vector2(98, 38.99997)
scale = Vector2(50, 50)
polygon = PackedVector2Array(0, -0.5, 0.5, 0.5, -0.5, 0.5)

[node name="ColorRect7" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=137267310]
layout_mode = 0
offset_left = 136.0
offset_top = 4.0
offset_right = 186.0
offset_bottom = 39.0
color = Color(0.735357, 0, 0, 1)

[node name="ColorRect8" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=752449690]
layout_mode = 0
offset_left = 193.0
offset_top = 4.0
offset_right = 243.0
offset_bottom = 39.0
pivot_offset = Vector2(44, 29)
color = Color(0, 0.735357, 0, 1)

[node name="ColorRect9" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=167545516]
layout_mode = 0
offset_left = 250.0
offset_top = 4.0
offset_right = 300.0
offset_bottom = 39.0
pivot_offset = Vector2(44, -4)
color = Color(0, 0, 0.735357, 1)

[node name="ColorRect10" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=1401542410]
layout_mode = 0
offset_left = 136.0
offset_top = 39.0
offset_right = 186.0
offset_bottom = 74.0
color = Color(1, 0, 0, 1)

[node name="ColorRect11" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=534544741]
layout_mode = 0
offset_left = 193.0
offset_top = 39.0
offset_right = 243.0
offset_bottom = 74.0
pivot_offset = Vector2(44, 29)
color = Color(0, 1, 0, 1)

[node name="ColorRect12" type="ColorRect" parent="VBoxContainer/ColorRect2/DeveloperSettings/Control2" unique_id=793779675]
layout_mode = 0
offset_left = 250.0
offset_top = 39.0
offset_right = 300.0
offset_bottom = 74.0
pivot_offset = Vector2(44, -4)
color = Color(0, 0, 1, 1)

[node name="DebugInfo" type="Label" parent="." unique_id=480223336]
layout_mode = 0
offset_left = 327.0
offset_right = 624.0
offset_bottom = 75.0
text = "DisplayServer supports HDR: true
RenderingDevice supports HDR: true
Window supports HDR: true"
script = ExtResource("8_5vw27")

[node name="BlackWhiteMax" type="Control" parent="." unique_id=1868827823]
custom_minimum_size = Vector2(97.615, 0)
anchors_preset = 0
offset_left = 633.0
offset_top = 2.0
offset_right = 893.0
offset_bottom = 77.0

[node name="Label" type="Label" parent="BlackWhiteMax" unique_id=1432220451]
layout_mode = 0
offset_left = 9.0
offset_top = 2.0
offset_right = 89.0
offset_bottom = 25.0
text = "Black"
horizontal_alignment = 1

[node name="Black" type="ColorRect" parent="BlackWhiteMax" unique_id=255226634]
layout_mode = 0
offset_left = 9.0
offset_top = 25.0
offset_right = 89.0
offset_bottom = 45.0
color = Color(0, 0, 0, 1)

[node name="Label4" type="Label" parent="BlackWhiteMax" unique_id=10137459]
layout_mode = 0
offset_left = 9.0
offset_top = 46.0
offset_right = 89.0
offset_bottom = 69.0
text = "0.00"
horizontal_alignment = 1

[node name="Label2" type="Label" parent="BlackWhiteMax" unique_id=733073890]
layout_mode = 0
offset_left = 89.0
offset_top = 2.0
offset_right = 169.0
offset_bottom = 25.0
text = "White"
horizontal_alignment = 1

[node name="White" type="ColorRect" parent="BlackWhiteMax" unique_id=725348665]
layout_mode = 0
offset_left = 89.0
offset_top = 25.0
offset_right = 169.0
offset_bottom = 45.0

[node name="Label5" type="Label" parent="BlackWhiteMax" unique_id=1454876637]
layout_mode = 0
offset_left = 89.0
offset_top = 46.0
offset_right = 169.0
offset_bottom = 69.0
text = "1.00"
horizontal_alignment = 1

[node name="Label3" type="Label" parent="BlackWhiteMax" unique_id=907524270]
layout_mode = 0
offset_left = 169.0
offset_top = 2.0
offset_right = 249.0
offset_bottom = 25.0
text = "Max"
horizontal_alignment = 1

[node name="Max" type="ColorRect" parent="BlackWhiteMax" unique_id=1672818577]
layout_mode = 0
offset_left = 169.0
offset_top = 25.0
offset_right = 249.0
offset_bottom = 45.0
script = ExtResource("13_ycdy4")

[node name="Label6" type="Label" parent="BlackWhiteMax" unique_id=1095042380]
layout_mode = 0
offset_left = 169.0
offset_top = 46.0
offset_right = 249.0
offset_bottom = 69.0
text = "1.00"
horizontal_alignment = 1
script = ExtResource("5_dg77c")

[node name="DemoScenes" type="ColorRect" parent="." unique_id=1892849244 node_paths=PackedStringArray("scenes")]
layout_mode = 0
offset_left = 324.0
offset_top = 78.0
offset_right = 1152.0
offset_bottom = 648.0
color = Color(0.21568628, 0.21568628, 0.21568628, 1)
script = ExtResource("6_272bh")
scenes = [NodePath("output_max_linear_value"), NodePath("EnvironmentScene"), NodePath("ColorSweep"), NodePath("SetupInstructions")]

[node name="Tab" type="ColorRect" parent="DemoScenes" unique_id=261230258]
layout_mode = 0
offset_left = 586.0
offset_top = -61.0
offset_right = 828.0
color = Color(0.21568628, 0.21568628, 0.21568628, 1)

[node name="OptionButton" type="OptionButton" parent="DemoScenes/Tab" unique_id=1332299268]
layout_mode = 0
offset_left = 9.0
offset_top = 28.0
offset_right = 234.0
offset_bottom = 59.0
selected = 0
item_count = 4
popup/item_0/text = "output_max_linear_value"
popup/item_0/id = 0
popup/item_1/text = "Environment"
popup/item_1/id = 1
popup/item_2/text = "Color sweep"
popup/item_2/id = 2
popup/item_3/text = "Setup instructions"
popup/item_3/id = 3

[node name="Label" type="Label" parent="DemoScenes/Tab" unique_id=1342427115]
layout_mode = 0
offset_left = 12.0
offset_top = 3.0
offset_right = 111.0
offset_bottom = 26.0
text = "Demo scene:"

[node name="output_max_linear_value" type="Control" parent="DemoScenes" unique_id=1640634166]
anchors_preset = 0
offset_right = 828.0
offset_bottom = 570.0

[node name="Mountain" type="Node2D" parent="DemoScenes/output_max_linear_value" unique_id=1183547058]
position = Vector2(29, 27)

[node name="Sun" type="ColorRect" parent="DemoScenes/output_max_linear_value/Mountain" unique_id=347517105]
offset_left = 73.0
offset_top = 8.0
offset_right = 239.0
offset_bottom = 108.0
color = Color(0.99215686, 0.7058824, 0.41568628, 1)
script = ExtResource("13_ycdy4")
sdr_colour = Color(0.99215686, 0.7058824, 0.41568628, 1)
max_linear_value_limit = 10.0

[node name="Mountain" type="Sprite2D" parent="DemoScenes/output_max_linear_value/Mountain" unique_id=1827667879]
texture_filter = 1
texture_repeat = 1
position = Vector2(160, 120)
texture = ExtResource("7_5vw27")

[node name="Sparkles" type="GPUParticles2D" parent="DemoScenes/output_max_linear_value" unique_id=817018124]
texture_filter = 1
position = Vector2(534, 165)
amount = 42
texture = ExtResource("8_kek77")
process_material = SubResource("ParticleProcessMaterial_dg77c")
script = ExtResource("9_4c57u")

[node name="Label" type="Label" parent="DemoScenes/output_max_linear_value" unique_id=558150534]
layout_mode = 0
offset_left = 95.0
offset_top = 458.0
offset_right = 703.0
offset_bottom = 533.0
text = "DRAFT DEMO PROJECT
HELP WANTED
Please let @allenwp know if you have a high quality demo for use in this scene."
horizontal_alignment = 1

[node name="Label2" type="Label" parent="DemoScenes/output_max_linear_value" unique_id=2086992899]
layout_mode = 0
offset_left = 315.0
offset_top = 360.0
offset_right = 519.0
offset_bottom = 409.0
text = "TODO: 3D model that uses
output_max_linear_value"

[node name="EnvironmentScene" type="Control" parent="DemoScenes" unique_id=1160571939]
visible = false
anchors_preset = 0
offset_left = 99.0
offset_top = 390.0
offset_right = 139.0
offset_bottom = 430.0
script = ExtResource("10_dg77c")

[node name="SubViewport" type="SubViewport" parent="DemoScenes/EnvironmentScene" unique_id=628806123]
own_world_3d = true
handle_input_locally = false
msaa_3d = 2
use_hdr_2d = true
size = Vector2i(570, 570)
render_target_update_mode = 4

[node name="Node3D" parent="DemoScenes/EnvironmentScene/SubViewport" unique_id=229028905 instance=ExtResource("11_dg77c")]

[node name="ViewportSprite" type="Sprite2D" parent="DemoScenes/EnvironmentScene" unique_id=448833630]
position = Vector2(315, -105)
texture = SubResource("ViewportTexture_efxa6")

[node name="Label2" type="Label" parent="DemoScenes/EnvironmentScene" unique_id=476553587]
layout_mode = 0
offset_left = 8.0
offset_top = 96.0
offset_right = 616.0
offset_bottom = 171.0
text = "DRAFT DEMO PROJECT
HELP WANTED
Please let @allenwp know if you have a high quality demo for use in this scene."
horizontal_alignment = 1

[node name="Label" type="Label" parent="DemoScenes/EnvironmentScene" unique_id=524097135]
layout_mode = 0
offset_left = -88.0
offset_top = -374.0
offset_right = 107.0
offset_bottom = -325.0
text = "TODO: 2D thing that uses
overbright colours"

[node name="ColorSweep" parent="DemoScenes" unique_id=784950953 instance=ExtResource("6_7mycd")]
visible = false
layout_mode = 0

[node name="SetupInstructions" type="RichTextLabel" parent="DemoScenes" unique_id=660978631]
visible = false
layout_mode = 0
offset_left = 55.0
offset_top = 5.0
offset_right = 776.0
offset_bottom = 551.0
focus_mode = 2
theme_override_fonts/mono_font = SubResource("SystemFont_7mycd")
bbcode_enabled = true
text = "[font_size=20]Steps to enable HDR output in your project:[/font_size]

1) Ensure all Environment resources do [i]not[/i] use SDR-only features:
	- Tonemap Mode: Filmic or ACES
	- Glow Blend Mode: Soft Light
	- Adjustments: Color Correction

2) Configure the [code]rendering/rendering_device/driver[/code] project setting to the following:
	- macos: metal
	- ios: metal
	- windows: d3d12

3) Turn on the [code]rendering/viewport/hdr_2d[/code] project setting and also turn on [code]use_hdr_2d[/code] of all Subviewport and Windows that should support HDR output.

4) Turn on the [code]display/window/hdr/request_hdr_output[/code] project setting and also turn on [code]hdr_output_requested[/code] of all other Windows that should support HDR output.

5) [Optional] Provide in-game settings for the player to adjust HDR brightness and maximum luminance by copying [code]in_game_hdr_settings[/code] from this demo into your project.

View the [url=\"https://github.com/godotengine/godot-docs/pull/11548\"]manual page[/url] to learn more about HDR output."
context_menu_enabled = true
vertical_alignment = 1
selection_enabled = true
drag_and_drop_selection_enabled = false
script = ExtResource("13_w48qg")

[connection signal="pressed" from="VBoxContainer/ColorRect2/DeveloperSettings/Button" to="VBoxContainer/ColorRect/InGameHDRSettings" method="erase_settings"]
[connection signal="item_selected" from="DemoScenes/Tab/OptionButton" to="DemoScenes" method="_on_demo_scene_item_selected"]
[connection signal="meta_clicked" from="DemoScenes/SetupInstructions" to="DemoScenes/SetupInstructions" method="_on_meta_clicked"]
